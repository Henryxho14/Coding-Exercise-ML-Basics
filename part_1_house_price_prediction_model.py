# -*- coding: utf-8 -*-
"""Part 1: House Price Prediction Model.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1K6KeqVDTatlxWTcEVUcUMTU2qioHD7ug
"""

import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.linear_model import LinearRegression
from sklearn.preprocessing import OneHotEncoder
from sklearn.compose import ColumnTransformer
from sklearn.pipeline import Pipeline

# ------------------------------------------------------------
# REALISTIC DATA SOURCE (100+ records):
# Kaggle: "House Prices: Advanced Regression Techniques" (Ames Housing)

# https://www.kaggle.com/competitions/house-prices-advanced-regression-techniques/data

# Columns used from Kaggle:
# - SalePrice  -> price (target)
# - GrLivArea  -> square_footage (feature)
# - Neighborhood -> location (feature)
# ------------------------------------------------------------

FILE_PATH = "/content/train_price_footage_location.csv"  # update to your local path

# Load Kaggle dataset
df_raw = pd.read_csv(FILE_PATH)

df = df_raw[["price", "footage", "location"]].copy()

# ------------------------------------------------------------
# Ames doesn't have a literal "Downtown" category, so we map a few older/central
# neighborhoods to "Downtown" (derived label based on real neighborhoods).
# ------------------------------------------------------------
DOWNTOWN_NEIGHBORHOODS = {"IDOTRR", "OldTown", "BrkSide", "Edwards"}
df.loc[df["location"].isin(DOWNTOWN_NEIGHBORHOODS), "location"] = "Downtown"

# Ensure we have plenty of rows (Kaggle train.csv has 1000+)
if len(df) < 100:
    raise ValueError("Dataset must have 100+ records.")

# ----------------------------
# Features and target (clearly defined)
# ----------------------------
X = df[["footage", "location"]]
y = df["price"]

# ----------------------------
# Encode location (OneHotEncoder) + pass through square_footage
# ----------------------------
preprocessor = ColumnTransformer(
    transformers=[
        ("location", OneHotEncoder(handle_unknown="ignore", sparse_output=False), ["location"])
    ],
    remainder="passthrough"
)

# ----------------------------
# Pipeline: preprocessing + Linear Regression
# ----------------------------
model = Pipeline(steps=[
    ("preprocessor", preprocessor),
    ("regressor", LinearRegression())
])

# Split + train
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=0.2, random_state=42
)
model.fit(X_train, y_train)

# ----------------------------
# Predict: 2000 sq ft in Downtown
# ----------------------------
new_house = pd.DataFrame({"footage": [2000], "location": ["Downtown"]})
predicted_price = model.predict(new_house)[0]
print(f"Predicted price for a 2000 sq ft house in Downtown: ${predicted_price:,.2f}")

# ----------------------------
# Print coefficients + explanations
# ----------------------------
# Get feature names in the *actual* order the model sees after preprocessing
feature_names = model.named_steps["preprocessor"].get_feature_names_out()
coefficients = model.named_steps["regressor"].coef_
intercept = model.named_steps["regressor"].intercept_

print("\nIntercept:")
print(f"  {intercept:,.2f}")

print("\nModel Coefficients:")
for name, coef in zip(feature_names, coefficients):
    print(f"  {name}: {coef:,.2f}")

sqft_feature_candidates = [n for n in feature_names if "footage" in n] # Adjusted to look for 'footage'
if not sqft_feature_candidates:
    raise ValueError("Could not find footage in feature names after preprocessing.")
sqft_feature_name = sqft_feature_candidates[0]
sqft_coef = float(coefficients[list(feature_names).index(sqft_feature_name)])

print("\nExplanation:")
print(
    f"- Price per sq ft: the coefficient for footage is {sqft_coef:,.2f}. "
    f"Holding location constant, increasing size by 1 sq ft changes the predicted price by about "
    f"${sqft_coef:,.2f}."
)

print(
    "- Location effect: location is one-hot encoded into indicator columns (e.g., location_Downtown). "
    "If a house is in that location, the indicator is 1 and its coefficient shifts the predicted price "
    "up/down relative to the modelâ€™s baseline behavior. In other words, the model uses:\n"
    "  predicted_price \u2248 intercept + (footage * sqft_coef) + (location adjustment)."
)